# If you're happy with the defaults, this file can be included as is in your project.

parameters:
  # These parameters are provided by MessageBusPass
  message_bus.permission_to_voter: ~
  message_bus.permissions_by_message: ~
  message_bus.message_to_handler: ~

services:
  _defaults:
    autowire: true

  ICanBoogie\MessageBus\VoterProvider:
    class: ICanBoogie\MessageBus\PSR\VoterProviderWithContainer
    arguments:
    - !tagged_locator { tag: message_bus.voter, index_by: permission }
    - '%message_bus.permission_to_voter%'

  ICanBoogie\MessageBus\VoterWithPermissions:
    arguments:
      $permissionsByMessage: '%message_bus.permissions_by_message%'

  ICanBoogie\MessageBus\HandlerProvider:
    class: ICanBoogie\MessageBus\PSR\ContainerHandlerProvider
    arguments:
    - !tagged_locator { tag: message_bus.handler }
    - '%message_bus.message_to_handler%'

  ICanBoogie\MessageBus\Dispatcher:
    class: ICanBoogie\MessageBus\SimpleDispatcher

  ICanBoogie\MessageBus\RestrictedDispatcher:
    class: ICanBoogie\MessageBus\RestrictedDispatcherWithVoter
    arguments:
      $voter: '@ICanBoogie\MessageBus\VoterWithPermissions'
